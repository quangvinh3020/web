<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quản Lý Mã Nguồn</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Admin Common CSS -->
  <link href="css/admin-common.css" rel="stylesheet">
  <style>
    /* Custom styles specific to this page */
    
    .file-input-wrapper {
      position: relative;
      display: inline-block;
      width: 100%;
    }
    
    .file-input-wrapper input[type=file] {
      position: absolute;
      left: -9999px;
    }
    
    .file-input-wrapper .btn {
      width: 100%;
      padding: 12px 15px;
      border: 2px dashed #dee2e6;
      background: #f8f9fa;
      color: #6c757d;
      border-radius: 10px;
      transition: all 0.3s ease;
    }
    
    .file-input-wrapper .btn:hover {
      border-color: #667eea;
      background: #f0f2ff;
      color: #667eea;
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <a href="admin.html" class="logo">
      <h3 class="text-white mb-0 fw-bold">
        <i class="bi bi-code-slash me-2"></i>
        WUANG VINH
      </h3>
      <small class="text-white-50">ADMIN PANEL</small>
    </a>
    <a href="quanlidanhmuc.html">
      <i class="bi bi-list-ul me-2"></i>Quản lí danh mục
    </a>
    <a href="src.html" class="active">
      <i class="bi bi-file-earmark-code me-2"></i>Mã Nguồn
    </a>
    <a href="atm.html">
      <i class="bi bi-bank me-2"></i>Ngân hàng
    </a>
    <a href="customer.html">
      <i class="bi bi-people me-2"></i>Khách hàng
    </a>
    <a href="lichsunap.html">
      <i class="bi bi-clock-history me-2"></i>Lịch sử nạp tiền
    </a>
    <a href="baiviet.html">
      <i class="bi bi-file-text me-2"></i>Bài Viết
    </a>
    <a href="settingadmin.html">
      <i class="bi bi-gear me-2"></i>Cấu hình
    </a>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Header -->
    <div class="content-header">
      <div class="row align-items-center">
        <div class="col">
          <h1 class="mb-0">
            <i class="bi bi-file-earmark-code text-primary"></i>
            Quản Lý Mã Nguồn
          </h1>
          <p class="text-muted mb-0">Thêm sản phẩm mã nguồn mới vào hệ thống</p>
        </div>
        <div class="col-auto">
          <button class="btn btn-outline-primary" onclick="window.location.href='sanpham.html'">
            <i class="bi bi-eye"></i> Xem Sản Phẩm
          </button>
        </div>
      </div>
    </div>

    <!-- Form Container -->
    <div class="form-container">
      
      
      <form id="productForm">
        <div class="row">
          <!-- Thông tin cơ bản -->
          <div class="col-md-6">
            <h5 class="mb-3 text-primary">
              <i class="bi bi-info-circle"></i> Thông Tin Cơ Bản
            </h5>
            
            <div class="mb-3">
              <label for="productName" class="form-label">
                <i class="bi bi-tag"></i> Tên sản phẩm
              </label>
              <input type="text" class="form-control" id="productName" 
                     placeholder="Nhập tên sản phẩm..." required>
            </div>
            
            <div class="mb-3">
              <label for="productPrice" class="form-label">
                <i class="bi bi-currency-dollar"></i> Giá sản phẩm
              </label>
              <div class="input-group">
                <input type="number" class="form-control" id="productPrice" 
                       placeholder="Nhập giá sản phẩm..." required>
                <span class="input-group-text">VNĐ</span>
              </div>
            </div>
            
            <div class="mb-3">
              <label for="categorySelect" class="form-label">
                <i class="bi bi-list-ul"></i> Danh mục
              </label>
              <select class="form-select" id="categorySelect" required>
                <option value="">Chọn danh mục...</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="productSale" class="form-label">
                <i class="bi bi-percent"></i> Giảm giá (%)
              </label>
              <input type="number" class="form-control" id="productSale" 
                     placeholder="Nhập % giảm giá..." min="0" max="100">
            </div>
          </div>
          
          <!-- Thông tin chi tiết -->
          <div class="col-md-6">
            <h5 class="mb-3 text-primary">
              <i class="bi bi-link-45deg"></i> Thông Tin Chi Tiết
            </h5>
            
            <div class="mb-3">
              <label for="productLinkDemo" class="form-label">
                <i class="bi bi-play-circle"></i> Link demo
              </label>
              <input type="url" class="form-control" id="productLinkDemo" 
                     placeholder="https://demo.example.com">
            </div>
            
            <div class="mb-3">
              <label for="productLinkTai" class="form-label">
                <i class="bi bi-download"></i> Link tải
              </label>
              <input type="url" class="form-control" id="productLinkTai" 
                     placeholder="https://download.example.com">
            </div>
            
            <div class="mb-3">
              <label for="productNameKey" class="form-label">
                <i class="bi bi-key"></i> Name key
              </label>
              <input type="text" class="form-control" id="productNameKey" 
                     placeholder="Nhập name key...">
            </div>
            
            <div class="mb-3">
              <label for="productImage" class="form-label">
                <i class="bi bi-image"></i> Ảnh sản phẩm
              </label>
              <div class="file-input-wrapper">
                <label class="btn btn-outline-secondary" for="productImage">
                  <i class="bi bi-upload"></i> Chọn ảnh...
                </label>
                <input type="file" id="productImage" accept="image/*" style="display: none;">
              </div>
              <div id="imagePreview" class="mt-2"></div>
            </div>
          </div>
        </div>
        
        <!-- Nội dung -->
        <div class="row mt-4">
          <div class="col-12">
            <h5 class="mb-3 text-primary">
              <i class="bi bi-file-text"></i> Nội Dung
            </h5>
            <div class="mb-3">
              <label for="productContent" class="form-label">
                <i class="bi bi-pencil"></i> Mô tả sản phẩm
              </label>
              <textarea class="form-control" id="productContent" rows="6" 
                        placeholder="Nhập mô tả chi tiết về sản phẩm..."></textarea>
            </div>
          </div>
        </div>
        
        <!-- Submit Button -->
        <div class="row mt-4">
          <div class="col-12">
            <button type="submit" class="btn btn-primary btn-lg w-100">
              <i class="bi bi-plus-circle"></i> Đăng Sản Phẩm
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    // Function hiển thị thông báo
    function showAlert(message, type) {
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
      alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
      alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      document.body.appendChild(alertDiv);
      
      setTimeout(() => {
        if (alertDiv.parentNode) {
          alertDiv.remove();
        }
      }, 5000);
    }

    $(document).ready(function() {
      // Load danh mục khi vào trang
      $.get('http://localhost:5000/api/categories', function(categories) {
        let options = '<option value="">Chọn danh mục...</option>';
        categories.forEach(cat => {
          options += `<option value="${cat.id}">${cat.name}</option>`;
        });
        $('#categorySelect').html(options);
      });

      // Preview ảnh
      $('#productImage').change(function() {
        const file = this.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            $('#imagePreview').html(`
              <img src="${e.target.result}" class="img-thumbnail" style="max-width: 200px; max-height: 200px;">
            `);
          };
          reader.readAsDataURL(file);
        }
      });

      // Xử lý submit form
      $('#productForm').submit(function(e) {
        e.preventDefault();
        
        // Hiển thị loading
        const submitBtn = $(this).find('button[type="submit"]');
        const originalText = submitBtn.html();
        submitBtn.html('<i class="bi bi-hourglass-split"></i> Đang xử lý...').prop('disabled', true);
        
        var formData = new FormData();
        formData.append('name', $('#productName').val());
        formData.append('price', $('#productPrice').val());
        formData.append('categoryId', $('#categorySelect').val());
        formData.append('sale', $('#productSale').val() || 0);
        formData.append('linkDemo', $('#productLinkDemo').val());
        formData.append('linkTai', $('#productLinkTai').val());
        formData.append('nameKey', $('#productNameKey').val());
        formData.append('content', $('#productContent').val());
        
        var file = $('#productImage')[0].files[0];
        if (file) formData.append('image', file);

        $.ajax({
          url: 'http://localhost:5000/api/products',
          method: 'POST',
          data: formData,
          processData: false,
          contentType: false,
          success: function(res) {
            showAlert('<i class="bi bi-check-circle"></i> Đăng sản phẩm thành công!', 'success');
            $('#productForm')[0].reset();
            $('#imagePreview').empty();
            
            // Reset button
            submitBtn.html(originalText).prop('disabled', false);
          },
          error: function(xhr) {
            const errorMessage = xhr.responseJSON?.error || 'Không thể đăng sản phẩm';
            showAlert(`<i class="bi bi-exclamation-triangle"></i> Lỗi: ${errorMessage}`, 'danger');
            
            // Reset button
            submitBtn.html(originalText).prop('disabled', false);
          }
        });
      });
    });
  </script>

</body>
</html>
