<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qu·∫£n L√Ω B√†i Vi·∫øt</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Admin Common CSS -->
  <link href="css/admin-common.css" rel="stylesheet">
  <style>
    /* Custom styles specific to this page */
    .article-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
    }
    
    /* NgƒÉn ch·∫∑n modal ƒë√≥ng khi click b√™n trong */
    .modal-content {
      pointer-events: auto;
    }
    
    .modal-content * {
      pointer-events: auto;
    }
    
    .article-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .article-title {
      font-size: 1.4rem;
      font-weight: bold;
      color: #4f46e5;
      margin-bottom: 10px;
    }
    
    .article-meta {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 15px;
    }
    
    .article-content {
      color: #333;
      line-height: 1.6;
    }
    
    .article-actions {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #eee;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .btn-edit, .btn-delete {
      padding: 6px 12px;
      border-radius: 5px;
      border: none;
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .btn-edit {
      background: #007bff;
      color: white;
    }
    
    .btn-delete {
      background: #dc3545;
      color: white;
    }
    
    .btn-edit:hover {
      background: #0056b3;
    }
    
    .btn-delete:hover {
      background: #c82333;
    }
    
    .search-container {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
      margin-bottom: 20px;
    }
    
    .stats-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      margin-bottom: 20px;
    }
    
    .stats-number {
      font-size: 2rem;
      font-weight: bold;
      color: #4f46e5;
    }
    
    .stats-label {
      color: #666;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <a href="admin.html" class="logo">
      <h3 class="text-white mb-0 fw-bold">
        <i class="bi bi-code-slash me-2"></i>
        WUANG VINH
      </h3>
      <small class="text-white-50">ADMIN PANEL</small>
    </a>
    <a href="quanlidanhmuc.html">
      <i class="bi bi-list-ul me-2"></i>Qu·∫£n l√≠ danh m·ª•c
    </a>
    <a href="src.html">
      <i class="bi bi-file-earmark-code me-2"></i>M√£ Ngu·ªìn
    </a>
    <a href="atm.html">
      <i class="bi bi-bank me-2"></i>Ng√¢n h√†ng
    </a>
    <a href="customer.html">
      <i class="bi bi-people me-2"></i>Kh√°ch h√†ng
    </a>
    <a href="lichsunap.html">
      <i class="bi bi-clock-history me-2"></i>L·ªãch s·ª≠ n·∫°p ti·ªÅn
    </a>
    <a href="baiviet.html" class="active">
      <i class="bi bi-file-text me-2"></i>B√†i Vi·∫øt
    </a>
    <a href="settingadmin.html">
      <i class="bi bi-gear me-2"></i>C·∫•u h√¨nh
    </a>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Content Header -->
    <div class="content-header">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1><i class="bi bi-file-text text-primary me-2"></i>Qu·∫£n L√Ω B√†i Vi·∫øt</h1>
          <p>Qu·∫£n l√Ω tin t·ª©c, h∆∞·ªõng d·∫´n v√† b√†i vi·∫øt h·ªá th·ªëng</p>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-primary" onclick="addNewArticle()">
            <i class="bi bi-plus-circle me-2"></i>Th√™m B√†i Vi·∫øt
          </button>
          <div class="user-dropdown">
            <div class="user-trigger" onclick="toggleDropdown()">
              <img src="img/user.png" alt="User Avatar" class="avatar">
              <span id="username">Ch∆∞a ƒëƒÉng nh·∫≠p</span>
              <span class="arrow">‚ñº</span>
            </div>
            <div id="dropdownMenu" class="dropdown-menu">
              <a href="#">S·ªë d∆∞: <span id="balance-display">0 ‚Ç´</span></a>
              <a href="#" onclick="loadTransactionHistory()">L·ªãch s·ª≠ ho·∫°t ƒë·ªông</a>
              <a href="#" onclick="logout()">ƒêƒÉng xu·∫•t</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="stats-card text-center">
          <div class="stats-number" id="totalArticles">2</div>
          <div class="stats-label">T·ªïng b√†i vi·∫øt</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card text-center">
          <div class="stats-number" id="publishedArticles">2</div>
          <div class="stats-label">ƒê√£ xu·∫•t b·∫£n</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card text-center">
          <div class="stats-number" id="draftArticles">0</div>
          <div class="stats-label">B·∫£n nh√°p</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card text-center">
          <div class="stats-number" id="totalViews">156</div>
          <div class="stats-label">L∆∞·ª£t xem</div>
        </div>
      </div>
    </div>

    <!-- Search Container -->
    <div class="search-container">
      <div class="row">
        <div class="col-md-8">
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input type="text" class="form-control" id="searchInput" placeholder="T√¨m ki·∫øm b√†i vi·∫øt...">
          </div>
        </div>
        <div class="col-md-4">
          <select class="form-select" id="filterStatus">
            <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
            <option value="published">ƒê√£ xu·∫•t b·∫£n</option>
            <option value="draft">B·∫£n nh√°p</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Articles List -->
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <!-- Loading -->
          <div id="loadingArticles" class="text-center py-5" style="display: none;">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">ƒêang t·∫£i...</span>
            </div>
            <p class="mt-3">ƒêang t·∫£i danh s√°ch b√†i vi·∫øt...</p>
          </div>
          
          <!-- Danh s√°ch b√†i vi·∫øt -->
          <div id="articlesList">
            <!-- Articles will be loaded here -->
          </div>
          
          <!-- No articles message -->
          <div id="noArticles" class="text-center py-5" style="display: none;">
            <i class="bi bi-newspaper" style="font-size: 4rem; color: #ccc;"></i>
            <h4 class="mt-3 text-muted">Ch∆∞a c√≥ b√†i vi·∫øt n√†o</h4>
            <p class="text-muted">H√£y th√™m b√†i vi·∫øt ƒë·∫ßu ti√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu!</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Article Modal -->
  <div class="modal fade" id="articleModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle">Th√™m b√†i vi·∫øt m·ªõi</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="articleForm">
            <div class="row">
              <div class="col-md-8">
                <div class="mb-3">
                  <label for="articleTitle" class="form-label">
                    <i class="bi bi-type-bold"></i> Ti√™u ƒë·ªÅ b√†i vi·∫øt *
                  </label>
                  <input type="text" class="form-control" id="articleTitle" name="title" 
                         placeholder="Nh·∫≠p ti√™u ƒë·ªÅ b√†i vi·∫øt..." required>
                </div>
                
                <div class="mb-3">
                  <label for="articleContent" class="form-label">
                    <i class="bi bi-file-text"></i> N·ªôi dung b√†i vi·∫øt *
                  </label>
                  <textarea class="form-control" id="articleContent" name="content" rows="12" 
                            placeholder="Nh·∫≠p n·ªôi dung b√†i vi·∫øt..." required></textarea>
                  <div class="form-text">
                    <i class="bi bi-info-circle"></i> H·ªó tr·ª£ Markdown: **bold**, *italic*, `code`, ## headings
                  </div>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="articleSummary" class="form-label">
                    <i class="bi bi-card-text"></i> T√≥m t·∫Øt
                  </label>
                  <textarea class="form-control" id="articleSummary" name="summary" rows="4" 
                            placeholder="T√≥m t·∫Øt ng·∫Øn g·ªçn v·ªÅ b√†i vi·∫øt..."></textarea>
                </div>
                
                <div class="mb-3">
                  <label for="articleImage" class="form-label">
                    <i class="bi bi-image"></i> ·∫¢nh ƒë·∫°i di·ªán
                  </label>
                  <div class="row">
                    <div class="col-md-8">
                      <input type="text" class="form-control" id="articleImage" name="image" 
                             placeholder="URL ·∫£nh ho·∫∑c ch·ªçn file upload...">
                    </div>
                    <div class="col-md-4">
                      <input type="file" class="form-control" id="imageFile" accept="image/*" style="display: none;">
                      <button type="button" class="btn btn-outline-primary btn-sm w-100" id="uploadBtn">
                        <i class="bi bi-upload"></i> Upload
                      </button>
                    </div>
                  </div>
                  <div id="imagePreview" class="mt-2" style="display: none;">
                    <img id="previewImg" src="" alt="Preview" class="img-thumbnail" style="max-height: 150px;">
                  </div>
                </div>
                
                <div class="mb-3">
                  <label for="articleStatus" class="form-label">
                    <i class="bi bi-toggle-on"></i> Tr·∫°ng th√°i
                  </label>
                  <select class="form-select" id="articleStatus" name="status">
                    <option value="published">ƒê√£ xu·∫•t b·∫£n</option>
                    <option value="draft">B·∫£n nh√°p</option>
                    <option value="archived">ƒê√£ l∆∞u tr·ªØ</option>
                  </select>
                </div>
                
                <div class="alert alert-info">
                  <i class="bi bi-lightbulb"></i>
                  <strong>Tips:</strong>
                  <ul class="mb-0 mt-2">
                    <li>Ti√™u ƒë·ªÅ n√™n ng·∫Øn g·ªçn, h·∫•p d·∫´n</li>
                    <li>N·ªôi dung c√≥ th·ªÉ s·ª≠ d·ª•ng Markdown</li>
                    <li>·∫¢nh ƒë·∫°i di·ªán s·∫Ω hi·ªÉn th·ªã ·ªü trang ch·ªß</li>
                  </ul>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x-circle"></i> H·ªßy
          </button>
          <button type="button" class="btn btn-primary" onclick="saveArticle()">
            <i class="bi bi-check-circle"></i> L∆∞u b√†i vi·∫øt
          </button>
        </div>
      </div>
    </div>
  </div>


  </div>

  <script>
    // Ki·ªÉm tra ph√¢n quy·ªÅn
    if (!localStorage.getItem("token") || localStorage.getItem("role") !== "Admin") {
      window.location.href = "user.html";
    }

    // Hi·ªÉn th·ªã t√™n ƒëƒÉng nh·∫≠p & s·ªë d∆∞
    window.onload = function () {
      const username = localStorage.getItem("username");
      const balance = localStorage.getItem("balance");
      
      if (username) {
        document.getElementById("username").textContent = username;
      }
      
      if (balance !== null) {
        document.getElementById("balance-display").textContent = `${Number(balance).toLocaleString()} ‚Ç´`;
      }
    };

    // Toggle dropdown
    function toggleDropdown() {
      const dropdown = document.getElementById("dropdownMenu");
      dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    }

    // ƒê√≥ng dropdown khi click b√™n ngo√†i
    document.addEventListener("click", function(event) {
      const dropdown = document.getElementById("dropdownMenu");
      const userTrigger = document.querySelector(".user-trigger");
      
      if (!userTrigger.contains(event.target)) {
        dropdown.style.display = "none";
      }
    });

    // Logout
    function logout() {
      localStorage.removeItem("token");
      localStorage.removeItem("username");
      localStorage.removeItem("role");
      localStorage.removeItem("balance");
      window.location.href = "login.html";
    }

    // Load transaction history
    function loadTransactionHistory() {
      window.location.href = "lichsunap.html";
    }

    // Th√™m b√†i vi·∫øt m·ªõi
    function addNewArticle() {
      showArticleModal();
    }

    // Ch·ªânh s·ª≠a b√†i vi·∫øt
    function editArticle(id) {
      console.log('‚úèÔ∏è B·∫Øt ƒë·∫ßu ch·ªânh s·ª≠a b√†i vi·∫øt ID:', id);
      
      // Disable button v√† hi·ªÉn th·ªã loading
      const editBtn = document.querySelector(`[onclick="editArticle('${id}')"]`);
      const originalText = editBtn.innerHTML;
      editBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> ƒêang t·∫£i...';
      editBtn.disabled = true;
      
      // Load b√†i vi·∫øt
      loadArticleForEdit(id).finally(() => {
        // Restore button
        editBtn.innerHTML = originalText;
        editBtn.disabled = false;
      });
    }

    // X√≥a b√†i vi·∫øt
    function deleteArticle(id) {
      const articleTitle = document.querySelector(`[onclick="deleteArticle('${id}')"]`)
        .closest('.article-card')
        .querySelector('.article-title')
        .textContent.replace(/[üìÑüìù]/g, '').trim();
      
      // Hi·ªÉn th·ªã modal x√°c nh·∫≠n x√≥a
      showDeleteConfirmModal(id, articleTitle);
    }

    // Xem tr∆∞·ªõc b√†i vi·∫øt - D√πng popup modal
    async function previewArticle(id) {
      try {
        console.log('üëÅÔ∏è Xem tr∆∞·ªõc b√†i vi·∫øt ID:', id);
        
        const token = localStorage.getItem('token');
        if (!token) {
          alert('‚ùå Kh√¥ng c√≥ token ƒëƒÉng nh·∫≠p. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i!');
          return;
        }
        
        // T√¨m b√†i vi·∫øt trong danh s√°ch hi·ªán t·∫°i
        const articles = await getCurrentArticles();
        const article = articles.find(a => a.id === id);
        
        if (!article) {
          console.error('‚ùå Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt v·ªõi ID:', id);
          alert('‚ùå Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt ƒë·ªÉ xem tr∆∞·ªõc!');
          return;
        }
        
        console.log('üìÑ T√¨m th·∫•y b√†i vi·∫øt ƒë·ªÉ xem tr∆∞·ªõc:', article.title);
        
        // Hi·ªÉn th·ªã modal xem tr∆∞·ªõc v·ªõi d·ªØ li·ªáu t·ª´ danh s√°ch
        showPreviewModal(article);
        
      } catch (error) {
        console.error('‚ùå Preview fetch error:', error);
        alert('‚ùå L·ªói khi t·∫£i b√†i vi·∫øt: ' + error.message);
      }
    }



    // Hi·ªÉn th·ªã modal th√™m/s·ª≠a b√†i vi·∫øt
    function showArticleModal(article = null) {
      const modal = new bootstrap.Modal(document.getElementById('articleModal'));
      const modalTitle = document.getElementById('modalTitle');
      const form = document.getElementById('articleForm');
      
      if (article) {
        modalTitle.textContent = 'Ch·ªânh s·ª≠a b√†i vi·∫øt';
        // ƒêi·ªÅn d·ªØ li·ªáu v√†o form
        document.getElementById('articleTitle').value = article.title;
        document.getElementById('articleContent').value = article.content;
        document.getElementById('articleSummary').value = article.summary || '';
        document.getElementById('articleImage').value = article.image || '';
        document.getElementById('articleStatus').value = article.status || 'published';
        form.dataset.articleId = article.id;
      } else {
        modalTitle.textContent = 'Th√™m b√†i vi·∫øt m·ªõi';
        form.reset();
        delete form.dataset.articleId;
      }
      
      modal.show();
    }

    // Load b√†i vi·∫øt ƒë·ªÉ ch·ªânh s·ª≠a
    async function loadArticleForEdit(id) {
      try {
        console.log('‚úèÔ∏è ƒêang t·∫£i b√†i vi·∫øt ƒë·ªÉ ch·ªânh s·ª≠a ID:', id);
        
        const token = localStorage.getItem('token');
        if (!token) {
          alert('‚ùå Kh√¥ng c√≥ token ƒëƒÉng nh·∫≠p. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i!');
          return;
        }
        
        // T√¨m b√†i vi·∫øt trong danh s√°ch hi·ªán t·∫°i
        const articles = await getCurrentArticles();
        const article = articles.find(a => a.id === id);
        
        if (!article) {
          console.error('‚ùå Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt v·ªõi ID:', id);
          alert('‚ùå Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt ƒë·ªÉ ch·ªânh s·ª≠a!');
          return;
        }
        
        console.log('üìÑ T√¨m th·∫•y b√†i vi·∫øt ƒë·ªÉ ch·ªânh s·ª≠a:', article.title);
        
        // Hi·ªÉn th·ªã modal v·ªõi d·ªØ li·ªáu t·ª´ danh s√°ch
        showArticleModal(article);
        
      } catch (error) {
        console.error('‚ùå Load article fetch error:', error);
        alert('‚ùå L·ªói k·∫øt n·ªëi: ' + error.message);
      }
    }

    // X√≥a b√†i vi·∫øt t·ª´ API
    async function deleteArticleFromAPI(id) {
      try {
        console.log('üóëÔ∏è ƒêang x√≥a b√†i vi·∫øt ID:', id);
        
        const token = localStorage.getItem('token');
        if (!token) {
          alert('‚ùå Kh√¥ng c√≥ token ƒëƒÉng nh·∫≠p. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i!');
          return;
        }
        
        // T√¨m b√†i vi·∫øt trong danh s√°ch hi·ªán t·∫°i ƒë·ªÉ l·∫•y ID ƒë√∫ng
        const articles = await getCurrentArticles();
        const article = articles.find(a => a.id === id);
        
        if (!article) {
          console.error('‚ùå Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt v·ªõi ID:', id);
          alert('‚ùå Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt ƒë·ªÉ x√≥a!');
          return;
        }
        
        console.log('üìÑ T√¨m th·∫•y b√†i vi·∫øt:', article.title);
        
        const response = await fetch(`http://127.0.0.1:5000/api/articles/${id}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        
        console.log('üìã Delete response status:', response.status);
        
        if (response.ok) {
          console.log('‚úÖ X√≥a b√†i vi·∫øt th√†nh c√¥ng!');
          showDeleteSuccessModal();
          loadArticles(); // Reload danh s√°ch
        } else {
          const error = await response.json();
          console.error('‚ùå Delete error:', error);
          showErrorModal('‚ùå L·ªói: ' + (error.message || 'Kh√¥ng th·ªÉ x√≥a b√†i vi·∫øt'));
        }
      } catch (error) {
        console.error('‚ùå Delete fetch error:', error);
        alert('‚ùå L·ªói k·∫øt n·ªëi: ' + error.message);
      }
    }

    // L·∫•y danh s√°ch b√†i vi·∫øt hi·ªán t·∫°i
    async function getCurrentArticles() {
      try {
        const token = localStorage.getItem('token');
        const response = await fetch('http://127.0.0.1:5000/api/articles', {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          return data.articles || [];
        }
        return [];
      } catch (error) {
        console.error('‚ùå L·ªói l·∫•y danh s√°ch b√†i vi·∫øt:', error);
        return [];
      }
    }

    // L∆∞u b√†i vi·∫øt
    async function saveArticle() {
      const form = document.getElementById('articleForm');
      const formData = new FormData(form);
      
      const articleData = {
        title: formData.get('title'),
        content: formData.get('content'),
        summary: formData.get('summary'),
        image: formData.get('image'),
        status: formData.get('status')
      };
      
      console.log('üìù Article data:', articleData);
      
      if (!articleData.title || !articleData.content) {
        alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!');
        return;
      }
      
      try {
        // N·∫øu c√≥ file ·∫£nh ƒë∆∞·ª£c ch·ªçn, upload tr∆∞·ªõc
        if (window.selectedImageFile) {
          console.log('üì§ Uploading image before saving article...');
          const imageResult = await uploadImage(window.selectedImageFile);
          if (imageResult) {
            articleData.image = imageResult.image_url;
            console.log('‚úÖ Image uploaded:', imageResult.image_url);
          } else {
            console.log('‚ùå Upload image failed, using existing image');
          }
        }
        
        const articleId = form.dataset.articleId;
        const url = articleId ? 
          `http://127.0.0.1:5000/api/articles/${articleId}` : 
          'http://127.0.0.1:5000/api/articles';
        const method = articleId ? 'PUT' : 'POST';
        
        console.log('üåê URL:', url);
        console.log('üìã Method:', method);
        console.log('üìù Final article data:', articleData);
        
        const token = localStorage.getItem('token');
        console.log('üîê Token:', token ? 'C√≥ token' : 'Kh√¥ng c√≥ token');
        
        // T·∫°o AbortController ƒë·ªÉ timeout
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 gi√¢y timeout
        
        try {
          const response = await fetch(url, {
            method: method,
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify(articleData),
            signal: controller.signal
          });
          
          clearTimeout(timeoutId);
        } catch (error) {
          clearTimeout(timeoutId);
          if (error.name === 'AbortError') {
            throw new Error('Request timeout - vui l√≤ng th·ª≠ l·∫°i');
          }
          throw error;
        }
        
        console.log('üìã Response status:', response.status);
        
        if (response.ok) {
          const result = await response.json();
          console.log('‚úÖ Success result:', result);
          
          const successMessage = articleId ? 
            '‚úÖ C·∫≠p nh·∫≠t b√†i vi·∫øt th√†nh c√¥ng!' : 
            '‚úÖ Th√™m b√†i vi·∫øt th√†nh c√¥ng!';
          showSaveSuccessModal(successMessage);
          
          // X√≥a file ƒë√£ ch·ªçn
          window.selectedImageFile = null;
          
          // ƒê√≥ng modal v√† reload danh s√°ch
          const modal = bootstrap.Modal.getInstance(document.getElementById('articleModal'));
          modal.hide();
          
          // Reload danh s√°ch sau khi l∆∞u
          setTimeout(() => {
            loadArticles();
          }, 500);
        } else {
          const error = await response.json();
          console.error('‚ùå API Error:', error);
          showErrorModal('‚ùå L·ªói: ' + (error.error || 'Kh√¥ng th·ªÉ l∆∞u b√†i vi·∫øt'));
        }
      } catch (error) {
        console.error('‚ùå Fetch error:', error);
        
        // Th·ª≠ l·∫°i n·∫øu l√† l·ªói network
        if (error.message.includes('Failed to fetch') || error.message.includes('timeout')) {
          console.log('üîÑ Th·ª≠ l·∫°i l·∫ßn 2...');
          try {
            const retryResponse = await fetch(url, {
              method: method,
              headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
                'Accept': 'application/json'
              },
              body: JSON.stringify(articleData)
            });
            
            if (retryResponse.ok) {
              const result = await retryResponse.json();
              console.log('‚úÖ Retry th√†nh c√¥ng:', result);
              
              const successMessage = articleId ? 
                '‚úÖ C·∫≠p nh·∫≠t b√†i vi·∫øt th√†nh c√¥ng!' : 
                '‚úÖ Th√™m b√†i vi·∫øt th√†nh c√¥ng!';
              showSaveSuccessModal(successMessage);
              
              // X√≥a file ƒë√£ ch·ªçn
              window.selectedImageFile = null;
              
              // ƒê√≥ng modal v√† reload danh s√°ch
              const modal = bootstrap.Modal.getInstance(document.getElementById('articleModal'));
              modal.hide();
              
              // Reload danh s√°ch sau khi l∆∞u
              setTimeout(() => {
                loadArticles();
              }, 500);
              return;
            }
          } catch (retryError) {
            console.error('‚ùå Retry c≈©ng th·∫•t b·∫°i:', retryError);
          }
        }
        
        showErrorModal('L·ªói k·∫øt n·ªëi: ' + error.message);
      }
    }

    // Load articles from API
    async function loadArticles() {
      const loadingDiv = document.getElementById('loadingArticles');
      const articlesList = document.getElementById('articlesList');
      const noArticlesDiv = document.getElementById('noArticles');
      
      loadingDiv.style.display = 'block';
      articlesList.innerHTML = '';
      noArticlesDiv.style.display = 'none';
      
      try {
        const token = localStorage.getItem('token');
        console.log('üîê Token:', token ? 'C√≥ token' : 'Kh√¥ng c√≥ token');
        
        const response = await fetch('http://127.0.0.1:5000/api/articles', {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        
        console.log('üìã Response status:', response.status);
        
        if (response.ok) {
          const data = await response.json();
          const articles = data.articles || [];
          console.log(`‚úÖ T·∫£i th√†nh c√¥ng ${articles.length} b√†i vi·∫øt`);
          
          if (articles.length === 0) {
            noArticlesDiv.style.display = 'block';
            updateStats([]); // C·∫≠p nh·∫≠t stats v·ªõi m·∫£ng r·ªóng
          } else {
            displayArticles(articles);
          }
        } else {
          const errorData = await response.json();
          console.error('‚ùå API Error:', errorData);
        }
      } catch (error) {
        console.error('‚ùå L·ªói k·∫øt n·ªëi:', error);
      } finally {
        loadingDiv.style.display = 'none';
      }
    }

    // Display articles
    function displayArticles(articles) {
      const articlesList = document.getElementById('articlesList');
      
      articlesList.innerHTML = articles.map(article => `
        <div class="article-card">
          <div class="article-title">
            <i class="bi bi-newspaper me-2"></i>${article.title}
            ${article.status === 'draft' ? '<span class="badge bg-warning ms-2">B·∫£n nh√°p</span>' : ''}
            ${article.status === 'archived' ? '<span class="badge bg-secondary ms-2">ƒê√£ l∆∞u tr·ªØ</span>' : ''}
          </div>
          <div class="article-meta">
            <i class="bi bi-person me-1"></i>ƒêƒÉng b·ªüi <strong>${article.author}</strong> ‚Ä¢ 
            <i class="bi bi-calendar me-1"></i>${formatDate(article.created_at)} ‚Ä¢
            <i class="bi bi-eye me-1"></i>${article.views} l∆∞·ª£t xem
          </div>
          <div class="article-content">
            ${article.summary || article.content.substring(0, 200) + '...'}
          </div>
          <div class="article-actions">
            <button class="btn-edit" onclick="editArticle('${article.id}')">
              <i class="bi bi-pencil"></i>Ch·ªânh s·ª≠a
            </button>
            <button class="btn-delete" onclick="deleteArticle('${article.id}')">
              <i class="bi bi-trash"></i>X√≥a
            </button>
            <button class="btn btn-sm btn-outline-secondary" onclick="previewArticle('${article.id}')">
              <i class="bi bi-eye"></i>Xem tr∆∞·ªõc
            </button>
          </div>
        </div>
      `).join('');
      
      // Update stats
      updateStats(articles);
    }

    // Update statistics
    function updateStats(articles) {
      const totalArticles = articles.length;
      const publishedArticles = articles.filter(a => a.status === 'published').length;
      const draftArticles = articles.filter(a => a.status === 'draft').length;
      const totalViews = articles.reduce((sum, a) => sum + (a.views || 0), 0);
      
      // Hi·ªÉn th·ªã 0 khi kh√¥ng c√≥ b√†i vi·∫øt
      document.getElementById('totalArticles').textContent = totalArticles || 0;
      document.getElementById('publishedArticles').textContent = publishedArticles || 0;
      document.getElementById('draftArticles').textContent = draftArticles || 0;
      document.getElementById('totalViews').textContent = totalViews || 0;
    }

    // Format date
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('vi-VN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit'
      });
    }

    // T√¨m ki·∫øm b√†i vi·∫øt
    document.getElementById("searchInput").addEventListener("input", function() {
      const searchTerm = this.value.toLowerCase();
      const articles = document.querySelectorAll(".article-card");
      
      articles.forEach(article => {
        const title = article.querySelector(".article-title").textContent.toLowerCase();
        const content = article.querySelector(".article-content").textContent.toLowerCase();
        
        if (title.includes(searchTerm) || content.includes(searchTerm)) {
          article.style.display = "block";
        } else {
          article.style.display = "none";
        }
      });
    });

    // Load articles on page load
    document.addEventListener('DOMContentLoaded', function() {
      loadArticles();
    });

    // L·ªçc theo tr·∫°ng th√°i
    document.getElementById("filterStatus").addEventListener("change", function() {
      const status = this.value;
      // Logic l·ªçc s·∫Ω ƒë∆∞·ª£c th√™m sau
      console.log("L·ªçc theo tr·∫°ng th√°i:", status);
    });

    // X·ª≠ l√Ω ch·ªçn ·∫£nh (ch·ªâ preview, kh√¥ng upload ngay)
    document.getElementById("imageFile").addEventListener("change", function(e) {
      console.log('üì∏ File input change event triggered');
      
      // NgƒÉn ch·∫∑n event propagation ƒë·ªÉ kh√¥ng ƒë√≥ng modal
      e.preventDefault();
      e.stopPropagation();
      
      const file = e.target.files[0];
      if (file) {
        console.log('üì∏ File ƒë∆∞·ª£c ch·ªçn:', file.name);
        
        // Ki·ªÉm tra k√≠ch th∆∞·ªõc file (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
          alert('‚ùå File qu√° l·ªõn! Vui l√≤ng ch·ªçn file nh·ªè h∆°n 5MB.');
          return;
        }
        
        // Ki·ªÉm tra lo·∫°i file
        if (!file.type.startsWith('image/')) {
          alert('‚ùå Vui l√≤ng ch·ªçn file ·∫£nh!');
          return;
        }
        
        // Ch·ªâ preview file, kh√¥ng upload ngay
        previewSelectedFile(file);
      }
    });

    // Debug: Ki·ªÉm tra modal c√≥ b·ªã ƒë√≥ng kh√¥ng
    document.addEventListener('DOMContentLoaded', function() {
      const articleModal = document.getElementById('articleModal');
      if (articleModal) {
        articleModal.addEventListener('hidden.bs.modal', function () {
          console.log('üîç Modal b·ªã ƒë√≥ng!');
        });
        
        // NgƒÉn ch·∫∑n modal ƒë√≥ng khi click b√™n trong
        articleModal.addEventListener('click', function(e) {
          if (e.target === articleModal) {
            e.preventDefault();
            e.stopPropagation();
            return false;
          }
        });
      }
      
      // Th√™m event listener cho button upload
      const uploadBtn = document.getElementById('uploadBtn');
      if (uploadBtn) {
        uploadBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('üì§ Upload button clicked');
          document.getElementById('imageFile').click();
        });
      }
    });

    // Preview file ƒë∆∞·ª£c ch·ªçn (kh√¥ng upload)
    function previewSelectedFile(file) {
      console.log('üñºÔ∏è Preview file:', file.name);
      
      // T·∫°o URL ƒë·ªÉ preview
      const fileUrl = URL.createObjectURL(file);
      
      // Hi·ªÉn th·ªã preview
      showImagePreview(fileUrl);
      
      // L∆∞u file v√†o bi·∫øn global ƒë·ªÉ upload sau
      window.selectedImageFile = file;
      
      // Hi·ªÉn th·ªã th√¥ng b√°o
      showFileSelectedMessage(file.name);
    }

    // Upload ·∫£nh l√™n server
    async function uploadImage(file) {
      try {
        console.log('üì§ ƒêang upload ·∫£nh...');
        
        const formData = new FormData();
        formData.append('image', file);
        
        const token = localStorage.getItem('token');
        const response = await fetch('http://127.0.0.1:5000/api/upload-image', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`
          },
          body: formData
        });
        
        if (response.ok) {
          const result = await response.json();
          console.log('‚úÖ Upload th√†nh c√¥ng:', result);
          
          // C·∫≠p nh·∫≠t input v√† preview
          document.getElementById('articleImage').value = result.image_url;
          showImagePreview(result.image_url);
          
          // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng nh·ªè
          showUploadSuccess();
          
          // Tr·∫£ v·ªÅ k·∫øt qu·∫£ ƒë·ªÉ s·ª≠ d·ª•ng trong saveArticle
          return result;
          
        } else {
          const error = await response.json();
          console.error('‚ùå Upload th·∫•t b·∫°i:', error);
          alert('‚ùå Upload th·∫•t b·∫°i: ' + (error.message || 'L·ªói kh√¥ng x√°c ƒë·ªãnh'));
          return null;
        }
        
      } catch (error) {
        console.error('‚ùå L·ªói upload:', error);
        alert('‚ùå L·ªói upload: ' + error.message);
        return null;
      }
    }

    // Hi·ªÉn th·ªã th√¥ng b√°o file ƒë∆∞·ª£c ch·ªçn
    function showFileSelectedMessage(fileName) {
      // T·∫°o th√¥ng b√°o nh·ªè
      const messageDiv = document.createElement('div');
      messageDiv.className = 'alert alert-info alert-dismissible fade show';
      messageDiv.style.position = 'fixed';
      messageDiv.style.top = '20px';
      messageDiv.style.right = '20px';
      messageDiv.style.zIndex = '9999';
      messageDiv.innerHTML = `
        <i class="bi bi-image"></i> ƒê√£ ch·ªçn: ${fileName}
        <br><small>·∫¢nh s·∫Ω ƒë∆∞·ª£c upload khi l∆∞u b√†i vi·∫øt</small>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      
      document.body.appendChild(messageDiv);
      
      // T·ª± ƒë·ªông ·∫©n sau 5 gi√¢y
      setTimeout(() => {
        if (messageDiv.parentNode) {
          messageDiv.remove();
        }
      }, 5000);
    }

    // Hi·ªÉn th·ªã th√¥ng b√°o upload th√†nh c√¥ng
    function showUploadSuccess() {
      // T·∫°o th√¥ng b√°o nh·ªè thay v√¨ alert
      const successDiv = document.createElement('div');
      successDiv.className = 'alert alert-success alert-dismissible fade show';
      successDiv.style.position = 'fixed';
      successDiv.style.top = '20px';
      successDiv.style.right = '20px';
      successDiv.style.zIndex = '9999';
      successDiv.innerHTML = `
        <i class="bi bi-check-circle"></i> Upload ·∫£nh th√†nh c√¥ng!
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      
      document.body.appendChild(successDiv);
      
      // T·ª± ƒë·ªông ·∫©n sau 3 gi√¢y
      setTimeout(() => {
        if (successDiv.parentNode) {
          successDiv.remove();
        }
      }, 3000);
    }

    // Hi·ªÉn th·ªã modal th√†nh c√¥ng khi x√≥a b√†i vi·∫øt
    function showDeleteSuccessModal() {
      const modalHTML = `
        <div class="modal fade" id="deleteSuccessModal" tabindex="-1" aria-labelledby="deleteSuccessModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-sm">
            <div class="modal-content">
              <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="deleteSuccessModalLabel">
                  <i class="bi bi-check-circle"></i> Th√†nh c√¥ng!
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body text-center">
                <i class="bi bi-check-circle text-success" style="font-size: 3rem;"></i>
                <h5 class="mt-3">X√≥a b√†i vi·∫øt th√†nh c√¥ng!</h5>
                <p class="text-muted">B√†i vi·∫øt ƒë√£ ƒë∆∞·ª£c x√≥a kh·ªèi h·ªá th·ªëng.</p>
              </div>
              <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-success" data-bs-dismiss="modal">
                  <i class="bi bi-check"></i> OK
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // X√≥a modal c≈© n·∫øu c√≥
      const oldModal = document.getElementById('deleteSuccessModal');
      if (oldModal) {
        oldModal.remove();
      }
      
      // Th√™m modal m·ªõi
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      
      // Hi·ªÉn th·ªã modal
      const modal = new bootstrap.Modal(document.getElementById('deleteSuccessModal'));
      modal.show();
      
      // T·ª± ƒë·ªông ƒë√≥ng sau 3 gi√¢y
      setTimeout(() => {
        const modalInstance = bootstrap.Modal.getInstance(document.getElementById('deleteSuccessModal'));
        if (modalInstance) {
          modalInstance.hide();
        }
      }, 3000);
    }

    // Hi·ªÉn th·ªã modal l·ªói
    function showErrorModal(message) {
      const modalHTML = `
        <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-sm">
            <div class="modal-content">
              <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="errorModalLabel">
                  <i class="bi bi-exclamation-triangle"></i> L·ªói!
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body text-center">
                <i class="bi bi-exclamation-triangle text-danger" style="font-size: 3rem;"></i>
                <h5 class="mt-3">C√≥ l·ªói x·∫£y ra!</h5>
                <p class="text-muted">${message}</p>
              </div>
              <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                  <i class="bi bi-x-circle"></i> ƒê√≥ng
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // X√≥a modal c≈© n·∫øu c√≥
      const oldModal = document.getElementById('errorModal');
      if (oldModal) {
        oldModal.remove();
      }
      
      // Th√™m modal m·ªõi
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      
      // Hi·ªÉn th·ªã modal
      const modal = new bootstrap.Modal(document.getElementById('errorModal'));
      modal.show();
    }

    // Hi·ªÉn th·ªã modal th√†nh c√¥ng khi l∆∞u b√†i vi·∫øt
    function showSaveSuccessModal(message) {
      const modalHTML = `
        <div class="modal fade" id="saveSuccessModal" tabindex="-1" aria-labelledby="saveSuccessModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-sm">
            <div class="modal-content">
              <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="saveSuccessModalLabel">
                  <i class="bi bi-check-circle"></i> Th√†nh c√¥ng!
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body text-center">
                <i class="bi bi-check-circle text-success" style="font-size: 3rem;"></i>
                <h5 class="mt-3">${message}</h5>
                <p class="text-muted">B√†i vi·∫øt ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng v√†o h·ªá th·ªëng.</p>
              </div>
              <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-success" data-bs-dismiss="modal">
                  <i class="bi bi-check"></i> OK
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // X√≥a modal c≈© n·∫øu c√≥
      const oldModal = document.getElementById('saveSuccessModal');
      if (oldModal) {
        oldModal.remove();
      }
      
      // Th√™m modal m·ªõi
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      
      // Hi·ªÉn th·ªã modal
      const modal = new bootstrap.Modal(document.getElementById('saveSuccessModal'));
      modal.show();
      
      // T·ª± ƒë·ªông ƒë√≥ng sau 3 gi√¢y
      setTimeout(() => {
        const modalInstance = bootstrap.Modal.getInstance(document.getElementById('saveSuccessModal'));
        if (modalInstance) {
          modalInstance.hide();
        }
      }, 3000);
    }

    // Hi·ªÉn th·ªã preview ·∫£nh
    function showImagePreview(imageUrl) {
      const preview = document.getElementById('imagePreview');
      const previewImg = document.getElementById('previewImg');
      
      previewImg.src = imageUrl;
      preview.style.display = 'block';
    }

    // Hi·ªÉn th·ªã modal x√°c nh·∫≠n x√≥a
    function showDeleteConfirmModal(articleId, articleTitle) {
      console.log('üóëÔ∏è Hi·ªÉn th·ªã modal x√°c nh·∫≠n x√≥a:', articleTitle);
      
      const modalTitle = document.getElementById('deleteConfirmModalLabel');
      const modalBody = document.getElementById('deleteConfirmModalBody');
      const confirmBtn = document.getElementById('deleteConfirmBtn');
      
      // C·∫≠p nh·∫≠t n·ªôi dung modal
      modalTitle.textContent = 'X√°c nh·∫≠n x√≥a b√†i vi·∫øt';
      modalBody.innerHTML = `
        <div class="text-center">
          <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
          <h5 class="mt-3">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i vi·∫øt?</h5>
          <p class="text-muted">"${articleTitle}"</p>
          <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle"></i>
            <strong>H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</strong>
          </div>
        </div>
      `;
      
      // C·∫≠p nh·∫≠t button x√°c nh·∫≠n
      confirmBtn.onclick = function() {
        console.log('üóëÔ∏è User confirmed delete for article ID:', articleId);
        deleteArticleFromAPI(articleId);
        
        // ƒê√≥ng modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal'));
        modal.hide();
      };
      
      // Hi·ªÉn th·ªã modal
      const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
      deleteModal.show();
    }

    // Hi·ªÉn th·ªã modal xem tr∆∞·ªõc b√†i vi·∫øt
    function showPreviewModal(article) {
      console.log('üé¨ Hi·ªÉn th·ªã popup xem tr∆∞·ªõc:', article.title);
      
      const modalTitle = document.getElementById('previewModalLabel');
      const modalContent = document.getElementById('previewModalContent');
      
      // C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ modal
      modalTitle.textContent = `Xem Tr∆∞·ªõc: ${article.title}`;
      
      // T·∫°o n·ªôi dung xem tr∆∞·ªõc
      const previewHTML = `
        <div class="article-preview">
          <div class="row">
            <div class="col-md-8">
              <h2 class="mb-3">${article.title}</h2>
              <div class="article-meta mb-4">
                <span class="badge bg-primary me-2">${article.status === 'published' ? 'ƒê√£ xu·∫•t b·∫£n' : 'B·∫£n nh√°p'}</span>
                <small class="text-muted">
                  <i class="bi bi-person me-1"></i>${article.author} ‚Ä¢ 
                  <i class="bi bi-calendar me-1"></i>${formatDate(article.created_at)} ‚Ä¢ 
                  <i class="bi bi-eye me-1"></i>${article.views || 0} l∆∞·ª£t xem
                </small>
              </div>
              ${article.image ? `<img src="${article.image}" class="img-fluid mb-4" alt="${article.title}">` : ''}
              <div class="article-summary mb-4">
                <h5>T√≥m t·∫Øt:</h5>
                <p class="text-muted">${article.summary || 'Kh√¥ng c√≥ t√≥m t·∫Øt'}</p>
              </div>
              <div class="article-content">
                <h5>N·ªôi dung:</h5>
                <div class="content-preview" style="max-height: 400px; overflow-y: auto; border: 1px solid #eee; padding: 20px; border-radius: 8px;">
                  ${article.content.replace(/\n/g, '<br>')}
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0">Th√¥ng tin b√†i vi·∫øt</h6>
                </div>
                <div class="card-body">
                  <p><strong>ID:</strong> ${article.id}</p>
                  <p><strong>Tr·∫°ng th√°i:</strong> 
                    <span class="badge ${article.status === 'published' ? 'bg-success' : 'bg-warning'}">
                      ${article.status === 'published' ? 'ƒê√£ xu·∫•t b·∫£n' : 'B·∫£n nh√°p'}
                    </span>
                  </p>
                  <p><strong>Ng√†y t·∫°o:</strong> ${formatDate(article.created_at)}</p>
                  <p><strong>L∆∞·ª£t xem:</strong> ${article.views || 0}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      modalContent.innerHTML = previewHTML;
      
      // Hi·ªÉn th·ªã modal
      const previewModal = new bootstrap.Modal(document.getElementById('previewModal'));
      previewModal.show();
    }
  </script>

  <!-- Modal xem tr∆∞·ªõc b√†i vi·∫øt -->
  <div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="previewModalLabel">Xem Tr∆∞·ªõc B√†i Vi·∫øt</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="previewModalContent">
            <!-- N·ªôi dung xem tr∆∞·ªõc s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal x√°c nh·∫≠n x√≥a b√†i vi·∫øt -->
  <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="deleteConfirmModalLabel">
            <i class="bi bi-exclamation-triangle"></i> X√°c nh·∫≠n x√≥a b√†i vi·∫øt
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="deleteConfirmModalBody">
          <!-- N·ªôi dung x√°c nh·∫≠n s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x-circle"></i> H·ªßy
          </button>
          <button type="button" class="btn btn-danger" id="deleteConfirmBtn">
            <i class="bi bi-trash"></i> X√≥a b√†i vi·∫øt
          </button>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
