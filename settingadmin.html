<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qu·∫£n tr·ªã website - Admin</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Admin Common CSS -->
  <link href="css/admin-common.css" rel="stylesheet">
  <style>
    .stats-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
    }
    
    .stats-card .icon {
      font-size: 3rem;
      opacity: 0.8;
    }
    
    .form-control {
      border-radius: 8px;
      border: 1px solid #e9ecef;
      padding: 12px 15px;
    }
    
    .form-control:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    
    .form-label {
      font-weight: 600;
      color: #495057;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <a href="admin.html" class="logo">
      <h3 class="text-white mb-0 fw-bold">
        <i class="bi bi-code-slash me-2"></i>
        WUANG VINH
      </h3>
      <small class="text-white-50">ADMIN PANEL</small>
    </a>
    <a href="quanlidanhmuc.html">
      <i class="bi bi-list-ul me-2"></i>Qu·∫£n l√≠ danh m·ª•c
    </a>
    <a href="src.html">
      <i class="bi bi-file-earmark-code me-2"></i>M√£ Ngu·ªìn
    </a>
    <a href="atm.html">
      <i class="bi bi-bank me-2"></i>Ng√¢n h√†ng
    </a>
    <a href="customer.html">
      <i class="bi bi-people me-2"></i>Kh√°ch h√†ng
    </a>
    <a href="lichsunap.html">
      <i class="bi bi-clock-history me-2"></i>L·ªãch s·ª≠ n·∫°p ti·ªÅn
    </a>
    <a href="baiviet.html">
      <i class="bi bi-file-text me-2"></i>B√†i Vi·∫øt
    </a>
    <a href="settingadmin.html" class="active">
      <i class="bi bi-gear me-2"></i>C·∫•u h√¨nh
    </a>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="container-fluid">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h4 class="mb-0">
                <i class="bi bi-gear me-2"></i>Qu·∫£n L√Ω Admin
              </h4>
            </div>
          </div>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="stats-card">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h3 class="mb-0" id="users-count">4</h3>
                <p class="mb-0">T·ªïng Users</p>
              </div>
              <div class="icon">
                <i class="bi bi-people"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h3 class="mb-0" id="products-count">5</h3>
                <p class="mb-0">S·∫£n Ph·∫©m</p>
              </div>
              <div class="icon">
                <i class="bi bi-box"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h3 class="mb-0" id="revenue-amount">2M</h3>
                <p class="mb-0">Doanh Thu</p>
              </div>
              <div class="icon">
                <i class="bi bi-currency-dollar"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h3 class="mb-0" id="orders-count">6</h3>
                <p class="mb-0">ƒê∆°n H√†ng</p>
              </div>
              <div class="icon">
                <i class="bi bi-cart"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Admin Settings -->
      <div class="row">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi bi-person-gear me-2"></i>C√†i ƒê·∫∑t T√†i Kho·∫£n
              </h5>
            </div>
            <div class="card-body">
              <form>
                <div class="mb-3">
                  <label for="adminUsername" class="form-label">T√™n ƒëƒÉng nh·∫≠p</label>
                  <input type="text" class="form-control" id="adminUsername" value="admin" readonly>
                </div>
                <div class="mb-3">
                  <label for="adminEmail" class="form-label">Email</label>
                  <input type="email" class="form-control" id="adminEmail" value="admin@wuangvinh.id.vn">
                </div>
                <div class="mb-3">
                  <label for="adminPassword" class="form-label">M·∫≠t kh·∫©u m·ªõi</label>
                  <input type="password" class="form-control" id="adminPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi">
                </div>
                <div class="mb-3">
                  <label for="adminConfirmPassword" class="form-label">X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                  <input type="password" class="form-control" id="adminConfirmPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u">
                </div>
                <button type="submit" class="btn btn-primary">
                  <i class="bi bi-check-circle me-2"></i>C·∫≠p Nh·∫≠t
                </button>
              </form>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi bi-shield-check me-2"></i>B·∫£o M·∫≠t
              </h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label class="form-label">X√°c th·ª±c 2 y·∫øu t·ªë</label>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="twoFactorAuth">
                  <label class="form-check-label" for="twoFactorAuth">B·∫≠t x√°c th·ª±c 2 y·∫øu t·ªë</label>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">Th√¥ng b√°o email</label>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                  <label class="form-check-label" for="emailNotifications">Nh·∫≠n th√¥ng b√°o qua email</label>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">ƒêƒÉng nh·∫≠p t·ª´ thi·∫øt b·ªã m·ªõi</label>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="newDeviceLogin" checked>
                  <label class="form-check-label" for="newDeviceLogin">Y√™u c·∫ßu x√°c th·ª±c</label>
                </div>
              </div>
              <button class="btn btn-outline-danger">
                <i class="bi bi-box-arrow-right me-2"></i>ƒêƒÉng Xu·∫•t T·∫•t C·∫£
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- System Info -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi bi-info-circle me-2"></i>Th√¥ng Tin H·ªá Th·ªëng
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <p><strong>Phi√™n b·∫£n:</strong> 1.1.0</p>
                  <p><strong>Database:</strong> MongoDB</p>
                  <p><strong>Backend:</strong> Python Flask</p>
                </div>
                <div class="col-md-6">
                  <p><strong>Uptime:</strong> 99.9%</p>
                  <p><strong>B·∫£o m·∫≠t:</strong> SSL/TLS</p>
                  <p><strong>Backup:</strong> H√†ng ng√†y</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Ki·ªÉm tra ph√¢n quy·ªÅn ng∆∞·ªùi d√πng
    if (!localStorage.getItem("token") || localStorage.getItem("role") !== "Admin") {
      window.location.href = "login.html";
    }

    // ƒêƒÉng xu·∫•t
    function logout() {
      localStorage.removeItem("token");
      localStorage.removeItem("username");
      localStorage.removeItem("role");
      window.location.href = "login.html";
    }

    // Script ƒë·ªÉ c·∫≠p nh·∫≠t th·ªëng k√™ th·ª±c t·ª´ database
    async function updateStats() {
      try {
        // L·∫•y th·ªëng k√™ t·ª´ API
        const response = await fetch('http://localhost:5000/api/stats', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`,
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          const stats = await response.json();
          
          // C·∫≠p nh·∫≠t c√°c s·ªë li·ªáu
          document.getElementById('users-count').textContent = stats.users_count;
          document.getElementById('products-count').textContent = stats.products_count;
          document.getElementById('revenue-amount').textContent = formatCurrency(stats.total_revenue);
          document.getElementById('orders-count').textContent = stats.completed_orders_count;
          
          console.log('Th·ªëng k√™ ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t:', stats);
        } else {
          console.error('L·ªói khi l·∫•y th·ªëng k√™:', response.status);
        }
      } catch (error) {
        console.error('L·ªói k·∫øt n·ªëi:', error);
      }
    }

    // Format ti·ªÅn t·ªá
    function formatCurrency(amount) {
      if (amount >= 1000000) {
        return (amount / 1000000).toFixed(1) + 'M';
      } else if (amount >= 1000) {
        return (amount / 1000).toFixed(0) + 'K';
      }
      return amount.toString();
    }

    // C·∫≠p nh·∫≠t th·ªëng k√™ khi trang load
    document.addEventListener('DOMContentLoaded', function() {
      updateStats();
      
      // C·∫≠p nh·∫≠t m·ªói 30 gi√¢y
      setInterval(updateStats, 30000);
    });

    // Debug function
    async function debugStats() {
      console.log("üîç Debugging stats API...");
      
      const token = localStorage.getItem('token');
      console.log("Token:", token ? "C√≥" : "Kh√¥ng");
      
      if (!token) {
        console.error("‚ùå Kh√¥ng c√≥ token, c·∫ßn ƒëƒÉng nh·∫≠p");
        return;
      }
      
      try {
        const response = await fetch('http://localhost:5000/api/stats', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        
        console.log("Response status:", response.status);
        
        if (response.ok) {
          const stats = await response.json();
          console.log("‚úÖ Stats data:", stats);
          
          // C·∫≠p nh·∫≠t UI
          document.getElementById('users-count').textContent = stats.users_count;
          document.getElementById('products-count').textContent = stats.products_count;
          document.getElementById('revenue-amount').textContent = formatCurrency(stats.total_revenue);
          document.getElementById('orders-count').textContent = stats.completed_orders_count;
          
          console.log("‚úÖ UI updated successfully");
        } else {
          const errorText = await response.text();
          console.error("‚ùå API Error:", response.status, errorText);
        }
      } catch (error) {
        console.error("‚ùå Network Error:", error);
      }
    }

    // Th√™m button debug
    document.addEventListener('DOMContentLoaded', function() {
      const debugButton = document.createElement('button');
      debugButton.textContent = 'Debug Stats';
      debugButton.className = 'btn btn-warning btn-sm';
      debugButton.onclick = debugStats;
      debugButton.style.position = 'fixed';
      debugButton.style.top = '10px';
      debugButton.style.right = '10px';
      debugButton.style.zIndex = '9999';
      document.body.appendChild(debugButton);
    });
  </script>
</body>
</html>
